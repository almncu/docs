# 时钟

本页面旨在收集有关时钟和时间的所有更新信息，截止到2011年12月。

您可以阅读freeswitch-dev邮件列表上的完整主题：“**Epoch current time difference**” <http://comments.gmane.org/gmane.comp.telephony.freeswitch.devel/4304>

Anthony Minessale说：

FS使用内核中的单调时钟来保持自己的时间，这与系统时间的机制相同，因此您的机器可能会出现时间不准确的情况。

允许任何软件信任系统时间非常危险。如果时间突然以小时或年为单位发生变化，那些依赖于系统时间来计算持续时间等的事情可能会受到相当大的影响。夏令时等事情可能会破坏CDR等内容。

FS中的时钟是内部的单调时钟，并且将与真实时间的偏移保留下来。如果您希望FS在需要时与系统时间同步，可以使用命令执行此操作。

Michael Giagnocavo说：

夏令时不应该修改时间，对于类似的情况，应该使用UTC时间或带有UTC偏移量的本地时间。任何因夏令时而导致计算持续时间不同的软件都不能责怪系统：它非常地、非常地有问题。

我想唯一的原因可能是时间值跳来跳去的是，如果您的时钟严重不同步，并且在强制进行大的NTP跳跃。但是在那种情况下，你也没什么办法。

那么，如果您在系统上使用NTP服务器会怎样呢？据我所知，在vmware等虚拟环境中，即使安装了vmware工具，您仍然需要与NTP服务器同步以保持时间的准确性。有关时间保持的更多信息，请尝试进行谷歌搜索，例如：“vmware timekeeping”。

Anthony Minessale说：

大多数情况下，您可能正在使用类似ntp的工具来同步系统时钟，如果是这样，当您更改ntp时间时，您应该同步FS时钟（例如，fsctl sync_clock）。 FreeSWITCH的性能将取决于虚拟环境的性能。

在生产环境中使用是非常安全的，但我们不会支持与在虚拟环境中运行有关的性能问题，因为存在太多变量和仿真，无法确定任何特定性能问题的根本原因。我们社区的会议服务器也是虚拟环境，但我们已经测试过使用openvz运行FreeSWITCH是最可靠的。

尤其是在当前FS HEAD版本下，如果您选择合适的具有完全CPU功率和亚马逊Linux操作系统的映像，它将按预期运行。

有一些与此主题相关的启动选项和命令。Anthony解释了启动选项：

**-nocal** 关闭启动时执行的校准时钟序列。它执行几个测试，以找到使您以确切的1毫秒睡眠应该睡眠的毫秒数。某些系统在这方面偏差较大，而测试会找到最佳值。当您指定-nocal时，它会使用默认值，即1000微秒。

**-nort** 实际上禁用了使用clock_nanosleep作为睡眠短时间的方法。对于许多系统来说，这个函数是最准确的，但对于其他一些系统来说，则不然。这个更难测试，所以我们必须手动解决。实际上，只有一些较旧的服务器需要这个选项。

在Windows上，默认行为与Peter解释的略有不同： 关于Windows - 是的，如果使用-monotonic-clock启动，它将像Unix系统一样工作，并使用真正的单调时钟。

使用以下命令将FS时钟与系统时钟同步：**fsctl sync\_clock** ([mod\_commands#sync\_clock](../Modules/mod_commands_1966741.mdx#sync_clock))

还有另一种命令可以在没有活动呼叫时"优雅"地进行同步：**fsctl sync\_clock\_when\_idle**。

您可以使用以下命令来检查FreeSWITCH的日期和时间：**strftime** ([mod\_dptools#strftime](../Modules/mod-dptools/6586520.mdx#about))。它返回本地系统时间。如果未指定format\_string，则默认为"%Y-%m-%d %T"，例如：2010-04-28 17:47:29。