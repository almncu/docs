# mod_sofia

## 关于

mod_sofia是由FreeSWITCH实现的SIP终端。

## 配置

#### sofia.conf.xml

```plaintext
accept-blind-auth|true,false  
accept-blind-reg|true,false  
aggressive-nat-detection|true,false
alias|任意
all-reg-options-ping|true,false
apply-candidate-acl|访问控制列表
apply-inbound-acl|访问控制列表
apply-nat-acl|访问控制列表
apply-proxy-acl|访问控制列表
apply-register-acl|访问控制列表
auth-all-packets|true,false
auth-calls|true,false
auth-messages|true,false
auto-jitterbuffer-msec|大于19的毫秒
auto-restart|true,false
auto-rtp-bugs|clear,CISCO_SKIP_MARK_BIT_2833,SONUS_SEND_INVALID_TIMESTAMP_2833,IGNORE_MARK_BIT,SEND_LINEAR_TIMESTAMPS,START_SEQ_AT_ZERO,NEVER_SEND_MARKER,IGNORE_DTMF_DURATION,ACCEPT_ANY_PACKETS,GEN_ONE_GEN_ALL,CHANGE_SSRC_ON_MARKER,FLUSH_JB_ON_DTMF
bind-params|transport=tcp,udp,tls
bitpacking|aal2（默认为3550包装）
caller-id-type|pid,rpid,none（默认为none）
capture-server|udp:x.x.x.x:port
challenge-realm|任意
cid-in-1xx|true,false
cng-pt|载荷号
codec-prefs|按逗号分隔的编解码器列表
confirm-blind-transfer|true,false
contact-user|任意
context|用于处理呼叫的上下文
db-inner-post-trans-execute|？
db-inner-pre-trans-execute|？
dbname|任意
db-post-trans-execute|？
db-pre-trans-execute|？
debug-presence|数字
debug-sla|数字
dialplan|用于处理呼叫的拨号计划（XML）
disable-hold|true,false
disable-naptr|true,false
disable-register|true,false
disable-rtp-auto-adjust|true,false
disable-srv|true,false
disable-srv503|true,false
disable-transcoding|true,false
disable-transfer|true,false
dtmf-duration| SWITCH_DEFAULT_DTMF_DURATION，即2000
dtmf-type|info,rfc2833,none
enable-100rel|true,false
enable-3pcc|true,false
enable-compact-headers|true,false
enable-rfc-5626|true,false
enable-soa|true,false
enable-timer|true,false
extended-info-parsing|true,false
ext-rtp-ip|ip地址
ext-sip-ip|ip地址
ext-sip-port|端口
fire-message-events|true,false
force-publish-expires|数字
force-register-db-domain|域名
force-register-domain|域名
force-subscription-domain|数字
force-subscription-expires|数字
forward-unsolicited-mwi-notify|true,false
full-id-in-dialplan|true,false
hold-music|任意
ignore-183nosdp|true,false
inbound-bypass-media|true,false
inbound-codec-negotiation|greedy,scrooge（默认为both）
inbound-codec-prefs|编解码器列表
inbound-late-negotiation|true,false
inbound-no-media|true,false
inbound-proxy-media|true,false
inbound-reg-force-matching-username|true,false
inbound-reg-in-new-thread|true,false
inbound-use-callid-as-uuid|true,false
inbound-zrtp-passthru|true,false **ZRTP已经弃用，并将在文档中删除**
in-dialog-chat|true,false
liberal-dtmf|true,false
local-network-acl|访问控制列表
log-auth-failures|true,false
log-level|数字
manage-presence|passive,pnp,true
manage-shared-appearance|true,false
manual-redirect|true,false
manual-rtp-bugs|rtp_bug_list
manual-video-rtp-bugs|rtp_bug_list
max-calls|数字
max-proceeding|数字
max-registrations-per-extension|数字
max-reg-threads|数字
media-option|resume-media-on-hold,bypass-media-after-att-xfer,bypass-media-after-hold
minimum-session-expires|数字
multiple-registrations|数字
mwi-use-reg-callid|true,false
nat-options-ping|udp-only,true（默认关闭）
NDLB-allow-bad-iananame|true,false
NDLB-allow-crypto-in-avp|true,false
NDLB-allow-nondup-sdp|true,false
NDLB-broken-auth-hash|true,false
NDLB-expires-in-register-response|true,false
NDLB-force-rport|safe,disabled,client-only,client-only
NDLB-received-in-nat-reg-contact|true,false
NDLB-sendrecv-in-session|true,false
NDLB-support-asterisk-missing-srtp-auth|true,false
nonce-ttl|数字
odbc-dsn|odbc dsn信息
outbound-codec-prefs|编解码器列表
outbound-use-uuid-as-callid|true,false
parse-all-invite-headers|true,false
pass-callee-id|true,false
p-asserted-id-parse|true,false
pass-rfc2833|true,false
pnp-provision-url|任意
presence-disable-early|true,false
presence-hold-state|confirmed,terminated
presence-hosts|主机名
presence-privacy|true,false
presence-probe-on-register|true,false
presence-proto-lookup|true
profile-standby|true,false
record-path|路径
record-template|要展开的模板
reg-deny-binding-fetch-and-no-lookup|true,false
registration-thread-frequency|数字，默认为IREG_SECONDS 30
renegotiate-codec-on-hold|true,false
renegotiate-codec-on-reinvite|true,false
require-secure-rtp|true,false
reuse-connections|true,false
rfc2833-pt|pt
rtcp-audio-interval-msec|毫秒
rtcp-video-interval-msec|毫秒
rtp-autofix-timing|true,false
rtp-digit-delay|大于0的数字
rtp-hold-timeout-sec|秒
rtp-ip|IP地址
rtp-notimer-during-bridge|true,false
rtp-rewrite-timestamps|true,false
rtp-timeout-sec|秒
rtp-timer-name|字符串
send-display-update|true,false
send-message-query-on-register|true,false
send-presence-on-register|true,false
session-timeout|秒
shutdown-on-fail|true,false
sip-capture|yes,no
sip-domain|域名
sip-expires-late-margin|秒
sip-expires-max-deviation|秒
sip-force-expires|秒
sip-ip|IP地址
sip-messages-respond-200-ok|true,false
sip-options-respond-503-on-busy|true,false
sip-port|端口
sip-subscription-max-deviation|秒
sip-trace|true,false
socket-tcp-keepalive|true,false
suppress-cng|true,false
t38-passthru|true,false
tcp-keepalive|毫秒
tcp-ping2pong|毫秒
tcp-pingpong|毫秒
timer-T1|默认为500ms（sofia将其默认为1000以防止竞争）
timer-T1X64|默认为32000
timer-T2|默认为4000
timer-T4|4000
tls-bind-params|transport=tls或%s;transport=tls
tls-cert-dir|目录
tls-ciphers|密码列表
tls-only|true,false
tls-passphrase|任意
tls-sip-port|端口
tls-timeout|大于0或300
tls-verify-date|数字
tls-verify-depth|数字
tls-verify-in-subjects|？
tls-verify-policy|？
tls-version|sslv2,sslv3,sslv23,tlsv1,tlsv1.1,tlsv1.2
tracelevel|数字
track-calls|true,false 
unregister-on-options-fail|true,false 
user-agent-filter|正则表达式
user-agent-string|字符串
username|SDP用户名
vad|true,false 
watchdog-enabled|true,false 
watchdog-event-timeout|秒
watchdog-step-timeout|秒
ws-binding|ip:port或:port
wss-binding|ip:port或:port
```

---
  
### 通话ID

#### inbound-use-callid-as-uuid

类型：布尔值

对于呼入电话，将会话的UUID设置为该呼叫的SIP呼叫ID。

```xml
<param name="inbound-use-callid-as-uuid" value="true"/>
```

内部SIP配置文件。

### 头部信息

#### parse-all-invite-headers

类型：布尔值

当为true时，mod_sofia将解析所有呼入的邀请头，并使用它们的值设置变量。一些自定义变量的前缀为“X-”，以区分它们与标准SIP头。

要了解更多信息，请搜索`sofia.c`中的字符串“`un_name`”，以查看如何构建变量。
---
  
## 另请参阅

[Sofia SIP堆栈](../Configuration/Sofia-SIP-Stack/index.mdx#faq)