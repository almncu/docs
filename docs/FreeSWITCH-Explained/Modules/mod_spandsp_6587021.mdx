# mod_spandsp

## 关于

FreeSWITCH™的一系列模块，包括`mod_fax`、`mod_t38gateway`和`mod_voipcodecs`现在被合并为一个模块，名为`mod_spandsp`。该模块充分利用了[spandsp](http://soft-switch.org)库中的所有DSP功能，包括T.38终端和网关功能。

单击此处展开目录表格

* 1 [安装](#installation)
* 2 [传真](#fax)
   * 2.1 [状态](#status)
   * 2.2 [从XML拨号计划中调用应用](#invoking-the-app-from-the-xml-dialplan)
      * 2.2.1 [用于接收传真](#for-receiving-a-fax)
         * 2.2.2 [用于发送传真](#for-transmitting-a-fax)
         * 2.2.3 [手动传真发送](#manual-fax-transmission)
         * 2.2.4 [基于传真会话结果执行](#execute-based-on-fax-session-outcome)
   * 2.3 [从CLI中调用应用](#invoking-the-app-from-the-cli)
      * 2.3.1 [用于发送传真](#for-transmitting-a-fax)
         * 2.3.2 [从SIP T.38源以ulaw格式发送传真](#for-transmitting-a-fax-over-ulaw-from-a-sip-t38-source)
   * 2.4 [fax2mail：传真接收后发送邮件](#fax2mail-emailing-the-fax-upon-receipt)
   * 2.5 [mail2fax：传真发送收到的邮件](#mail2fax-faxing-a-received-mail)
   * 2.6 [配置应用](#configuring-the-app)
   * 2.7 [控制应用](#controlling-the-app)
   * 2.8 [检查结果](#checking-the-results)
      * 2.8.1 [传真结果代码](#spandsptxfaxresult)
   * 2.9 [t38_gateway应用](#t38_gateway-app)
      * 2.9.1 [T.38重新邀请](#t38-reinvite)
         * 2.9.2 [T.38转码](#spandsptxfaxresult)
   * 2.10 [接收传真](#receive-faxes)
   * 2.11 [发送传真](#transmit-faxes)
   * 2.12 [传真音调检测](#stop-fax-tone-detection)
      * 2.12.1 [完整示例](#full-example)
   * 2.13 [停止传真音调检测](#stop-fax-tone-detection)
* 3 [示例](#examples)
   * 3.1 [T.38对TDM的传出传真](#outbound-fax-t38-to-tdm)
   * 3.2 [TDM对T.38的传入传真](#inbound-fax-tdm-to-t38)
   * 3.3 [内部T.38到T.38](#internal-t38-to-t38)
* 4 [结果](#spandsptxfaxresult)
   * 4.1 [测试中收到的问题](#questions-i-got-during-testing)
* 5 [事件](#events)
   * 5.1 [spandsp::rxfaxpageresult](#spandsprxfaxpageresult)
   * 5.2 [spandsp::txfaxpageresult](#spandsptxfaxpageresult)
   * 5.3 [spandsp::rxfaxnegociateresult](#spandsprxfaxnegociateresult)
   * 5.4 [spandsp::txfaxnegociateresult](#spandsptxfaxnegociateresult)
   * 5.5 [spandsp::txfaxresult](#spandsptxfaxresult)
   * 5.6 [spandsp::rxfaxresult](#spandsprxfaxresult)
* 6 [故障排除](#troubleshooting)
   * 6.1 [常见问题](#common-issues)
   * 6.2 [建议的处理流程](#suggested-process)
   * 6.3 [示例](#example)
   * 6.4 [进一步调试](#further-debugging)
* 7 [音调检测](#fax-tone-detection)
   * 7.1 [DTMF](#dtmf)
      * 7.1.1 [相关的音调通道变量](#related-tone-channel-variables)
         * 7.1.2 [拨号计划应用](#dialplan-applications)
   * 7.2 [呼叫进度](#call-progress)
      * 7.2.1 [配置](#configuration)
         * 7.2.2 [拨号计划应用](#dialplan-applications)
         * 7.2.3 [API](#apis)
         * 7.2.4 [事件](#events)
* 8 [编解码器](#codecs)
* 9 [软调制解调器](#software-modem)
   * 9.1 [Windows的COM端口设置](#com-port-setting-for-windows)
* 10 [参见](#see-also)

## 安装

这份文档的大部分是在 spandsp 刚刚发布时编写的。很多笔记和参考资料都已经非常过时了，但是为了保持一致性，暂时保留在这里。

`mod_spandsp` 默认在 `modules.conf` 中启用，并且会自动编译。它还默认在 `modules.conf.xml` 中启用。

请确保已安装了 libtiff 的开发文件。请参考安装页面上的依赖项。

对于 Debian/Ubuntu，您可以输入以下命令：

```xml
apt-get install libtiff4-dev
```

对于 CentOS 5.x：

```xml
yum install libtiff-devel libjpeg-devel
```

如果收到有关 TIFF 库的错误，请尝试以下操作：

```xml
make tiff-reconf
```

\* 对于 FreeBSD

```xml
cd /usr/ports/graphics/tiff
make install clean
```

\* 编译错误/问题
如果收到类似 "`/usr/bin/ld: cannot find -ljpeg`" （FreeBSD）的错误，请仔细检查是否已安装了 tiff 库，上面有关如何在您的操作系统上进行安装的说明。

\* 对于 SUSE

```xml
zypper install libtiff-devel libjpeg-devel
```

\* 一般构建错误

如果加载 mod\_spandsp 时出错，请尝试：

```xml
make spandsp-reconf && make install
```

重新构建 spandsp 库。

## 传真

### 状态

请务必创建配置 XML 文件，因为只能在那里配置传真的 spool 目录。

需要完成的事项：

\* 在每次收发传真时触发事件。  
\* 在每次收发传真页面时触发事件。

另外，`mod_spandsp` 要求您在 T.30 传真中使用 G.711（PCMA/PCMU）编解码器，否则将无法正常工作。如果您在发送时使用 `txfax`，在接收时使用 `rxfax`，请记得两端使用相同的编解码器。

### 从 XML 拨号计划调用应用程序

你可以调用 rxfax 应用程序，并使用数据选项将 TIFF 文件名传递给它。如果你不在数据选项中传递任何信息，mod_spandsp将为你创建文件名，并将接收到的传真放入你的传真队列目录中。

#### 接收传真

```xml
<extension name="test_rxfax_stream">
  <condition field="destination_number" expression="^\*90012$">
    <action application="answer" />
    <action application="playback" data="silence_stream://2000"/>
    <action application="rxfax" data="//my_directory//rxfax.tiff"/>
    <action application="hangup"/>
  </condition>
</extension>
```

如果你想要每个传真都有唯一的名称，你可以使用以下变体：

```xml
<extension name="fax_receive">
  <condition field="destination_number" expression="^9978$">
    <action application="answer" />
    <action application="playback" data="silence_stream://2000"/>
    <action application="rxfax" data="/tmp/FAX-${uuid}.tif"/>
    <action application="hangup"/>
  </condition>
</extension>
```

如果你希望 mod_spandsp 发送 T.38 的重新 INVITE （符合标准），请使用以下示例：

```xml
<extension name="fax_receive">
  <condition field="destination_number" expression="^9978$">
    <action application="answer" />
    <action application="playback" data="silence_stream://2000"/>
    <action application="set" data="fax_enable_t38_request=true"/>
    <action application="set" data="fax_enable_t38=true"/>
    <action application="rxfax" data="/tmp/FAX-${uuid}.tif"/>
    <action application="hangup"/>
  </condition>
</extension>
```

#### 发送传真

可以使用 ImageMagick 将 PDF 文件转换为 TIFF 格式，这是一个示例：

```xml
convert -density 204x98 -units PixelsPerInch -resize 1728x1186\! -monochrome -compress Fax txfax.pdf txfax.tiff
```

明确单位（在我的机器上，默认为公制系统）。另外，叹号强制使用特定的比例。你可以考虑使用`graphicsmagick`，因为它通常更快并支持群组4压缩。请记住，这些工具仍然依赖于Ghostscript来使用gs的pnm设备进行pdf转换。GM的质量实际上比Ghostscript产生的质量要好，Ghostscript太过于使用抖动技术。我成功地使用graphicsmagick的宽度2156，尽管这里为imagemagick和Ghostscript指定了不同的宽度。

对于PDF/PS文件，你可以使用Ghostscript。以下是一个示例，生成一个标准分辨率的TIFF文件：

```xml
gs -q -r204x98 -g1728x1078 -dNOPAUSE -dBATCH -dSAFER -dPDFFitPage -sDEVICE=tiffg3 -sOutputFile=txfax.tiff -- txfax.pdf
```

以下是一个示例，生成一个精细分辨率的TIFF文件：

```xml
gs -q -r204x196 -g1728x2156 -dNOPAUSE -dBATCH -dSAFER -dPDFFitPage -sDEVICE=tiffg3 -sOutputFile=txfax.tiff -- txfax.pdf
```

[使用ghostscript进行PDF转TIFF](https://soft-switch.org/spandsp%5Ffaq/ar01s14.html)

Ghostscript无法将您的文档放置在正确的方向上。这对于发送到远程纸质机器来说并不是一个真正的问题，但在电脑上接收传真时可能会让人心烦。

使用`-g1728x1078`和`-g1728x2156`确保生成的TIFF文件包含与传真机兼容的页面大小。如果PDF文件包含位图图像而不是可伸缩内容，则生成的TIFF文件中的图像可能不适合页面。

你可以使用以下拨号计划来传输传真：

```xml
<extension name="test_txfax_stream">
  <condition field="destination_number" expression="^\*90012$">
    <action application="txfax" data="txfax.tiff"/>
    <action application="hangup"/>
  </condition>
</extension>
```

#### 手动传真传输

当发送到传真机时，一个实时的操作员会给你一个传真信号，bind\_meta\_app非常方便。

```xml
<extension name="pstn-fxo-dialout">
  <condition field="${toll_allow}" expression="local,domestic"/>
  <condition field="destination_number" expression="^9([2-9]\d{6})$">
    <action application="set" data="effective_caller_id_number=${outbound_caller_id_number}"/>
    <action application="set" data="effective_caller_id_name=${outbound_caller_id_name}"/>
    <action application="bind_meta_app" data="5 a o transfer:: 9179 XML default"/> 
    <action application="set" data="hold_music=silence"/>
    <action application="answer"/>
    <action application="sleep" data="50"/>
    <action application="playback" data="ivr/ivr-hold_connect_call.wav"/>
    <action application="bridge" data="sofia/gateway/fxo/$1@192.168.0.99:5062"/>
  </condition>
</extension>
```

#### 根据传真会话结果执行

通道变量允许您根据传真传输的成功或失败采取操作。

可用变量：`execute_on_fax_success`，`execute_on_fax_result`，`execute_on_fax_failure`，`execute_on_fax_detect`。在您的`rxfax`应用调用之前根据需要插入。

示例：当`mod_spandsp`报告传输成功时运行一个lua脚本。

```xml
<action application="set" data="execute_on_fax_success=lua process_fax.lua"/>
```

示例：当`mod_spandsp`报告传输失败时运行一个shell命令。

```xml
<action application="set" data="execute_on_fax_failure=system /bin/rm tmp/FAX-${uuid}.tif"/>
```

### 从 CLI 调用应用程序

#### 传真传输

在 CLI 中，使用外部配置文件通过网关 10.10.10.10 发送传真到传真机号码 100，你需要使用以下命令：

```xml
originate sofia/external/100@10.10.10.10 &txfax(/path_to_fax_file)
```

如果需要指定要使用的网关：

```xml
originate sofia/gateway/<gateway name>/<phone number> &txfax(/path_to_fax_file)
```

#### 从 SIP T.38 源传输 ulaw 格式的传真

* 确保你至少有 FreeSWITCH Git 在 2010 年 5 月 25 日之后的版本。
* 你还需要加载 mod\_spandsp。
* 在 conf/autoload\_configs/spandsp.conf.xml 文件中将 enable-t38 参数设置为 true。
* 注意：较旧的 FreeSWITCH 版本使用的是 fax.conf.xml。如果找不到 spandsp.conf.xml，则较新的版本只使用 fax.conf.xml。
* 在执行 bridge 前，执行 t38\_gateway 并将参数设置为 'self'。这将监视传真信号音以便在需要时切换到 T.38。

我使用 Linksys SPA3102 进行了测试，你需要将 T.38 模式设置为 ReInvite。

### fax2mail：接收传真后通过电子邮件发送传真

在最新版本的 FreeSWITCH 中，一旦 rxfax 完成，拨号计划就会结束，api\_hangup\_hook 将执行脚本。在拨号计划中，将 api\_hangup\_hook 设置在 rxfax 之前非常重要。此外，如果你在系统脚本中使用任何传真变量，你需要用 \\\\\\ 进行转义  
（例如：\\\\\\${fax\_image\_size}）。

此拨号计划还演示了一些针对仅具有专用传真机附件的特定 UA 的可能正则表达式，这样它们就会将传真作为电子邮件附件发送到在线传真服务。

```xml
<include>
  <extension name="outbound_fax">
    <condition field="caller_id_number" expression="^(100[23])$"/>
    <condition field="destination_number" expression="^(1\d{10})$">
      <action application="set" data="api_hangup_hook=system ${base_dir}/scripts/emailfax.sh $1 /tmp/${uuid}.rxfax.tiff"/> 
      <action application="answer"/>
      <action application="playback" data="silence_stream://2000"/>
      <action application="rxfax" data="/tmp/${uuid}.rxfax.tiff"/>
      <action application="hangup"/>
    </condition>
  </extension>
</include>
```

\* Uuencode被认为是一种不再得到良好支持且不如mime格式好的传输格式。使用mutt发送附件可以解决这个问题，但要格式化电子邮件需要进行一些配置设置。这个解决方案提供了处理此类情况的方法。编辑路径和域名以匹配您的传真服务。创建${base\_dir}/scripts/emailfax.sh文件如下所示：

```xml
#!/bin/bash
#
# $1是邮箱别名（拨打的号码）
# $2是文件名

mutt -n -f /dev/null -F /opt/freeswitch/scripts/muttrc -s "向 $1@myfax.com发传真" $1@myfax.com -a $2 < /dev/null
```

\* 现在创建muttrc文件。该配置允许发送没有本地邮箱的邮件，而在运行FreeSWITCH的用户可能没有这样的邮箱（您可以添加更多配置以调整电子邮件的头部）：

```xml
set from = 'alias@域名'
set realname = '您的组织名'
set folder = /dev/null
```

以下是另一个示例，使用一个名为\[<http://steffler.info/wp-content/uploads/2009/06/process-rxfax.py> process-rxfax.py\]的Python脚本，通过Dialplan XML使用：

```xml
<扩展名 name="test_rxfax_python">
  <条件 field="destination_number" expression="^\*90012$">
    <操作 应用="set" 数据="recipient=YOU@YOURDOMAINHERE.com"/> <!--更改为收件人的电子邮件地址 -->
    <操作 应用="python" 数据="process-rxfax"/> 
    <操作 应用="hangup"/>
  </条件>
</扩展名>
```

[这个python脚本](http://steffler.info/wp-content/uploads/2009/06/process-rxfax.py)将放在您的FreeSWITCH的mod_python路径中，并将启动mod_spandsp来接收传真，然后将其转换为PDF并通过电子邮件发送。该脚本需要安装ps2pdf实用程序（来自Ghostscript）和tiff2ps。在FreeBSD中，这些在Ports中，并且在大多数Linux发行版中也可以通过软件包管理（apt-get、yum、rpm等）获得。这个python脚本还需要一个正常工作的mod_python和mod_spandsp安装。更多信息请参考\[这里](http://steffler.info/my-first-python-script-receive-a-fax-via-freeswitch-spandsp)。

### mail2fax:传真接收电子邮件

有几个部分：  
\* 告诉MTA在收到特殊地址的邮件时运行脚本（示例[faxnumber@fax.domain.org](mailto:faxnumber@fax.domain.org)）：  
\*\* 示例请查看<http://hylafax.sourceforge.net/howto/faxing.php#ss5.4>  
\* 创建一个名为email2fax的脚本：  
\*\* 从电子邮件中猜测传真号码  
\*\* 运行\[<https://freeswitch.org/fisheye/changelog/freeswitch-contrib/sathieu/email2pdf> email2pdf\]  
\*\* 将PDF转换为tiff格式  
\*\* 在FS中调用txfax

将email2pdf安装到/usr/local/email2pdf中。将主要脚本链接到电子邮件用户的路径（在下面的脚本中使用了/usr/local/bin）。根据需要编辑header.html。

创建文件`/usr/local/email2pdf/emails`，并将您希望授权的发件人邮箱放入其中。

如果使用postfix，您可以通过将以下内容添加到`/etc/postfix/[master.cf](http://master.cf)`来设置传真发送代理：

```xml
email2fax unix - n n - - pipe
flags= user=nobody argv=/usr/local/bin/email2fax $mailbox $sender
```

然后将以下内容添加到`/etc/aliases`并运行`postalias`：

```xml
mail2fax: |/usr/local/bin/email2fax
```

然后配置您的电子邮件服务器将一个新的域名（例如[fax.mydomain.com](http://fax.mydomain.com)）转发到`mail2fax`别名。在postfix中，这可能涉及添加传输映射（transport\_maps）以及中继接收方（relay\_recipient\_maps）。如何处理将取决于您的邮件服务器配置。

`email2fax`脚本可能如下所示：

```xml
#!/bin/sh
set -e
PATH=/usr/local/bin:/usr/bin:/bin
TMPMAIL=/tmp/email2fax.$$.txt
TMPPDF=/tmp/email2fax.$$.pdf
TMPFAX=/tmp/email2fax.$$.tiff
TMPLOG=/tmp/email2fax.$$.log
DEST='sofia/external/100@10.10.10.10'
＃或
＃DEST="sofia/gateway/sip.provider.com/$1"
＃检查文件中的原始电子邮件地址
＃如果不在该文件中，则中止
grep -i "$2" "/usr/local/email2pdf/emails" >/dev/null
if [ $? -ne 0]; then
echo "用户不允许！"
exit 1;
fi
cat > $TMPMAIL
cat $TMPMAIL | email2pdf --header=/usr/local/email2pdf/header.html - $TMPPDF >> $TMPLOG
#rm $TMPMAIL
gs -q -r204x98 -g1728x1078 -dNOPAUSE -dBATCH -dSAFER -dPDFFitPage -sDEVICE=tiffg3 -sOutputFile=$TMPFAX -- $TMPPDF >> $TMPLOG
#rm $TMPPDF
chmod o+r $TMPFAX
/opt/freeswitch/bin/fs_cli \
--execute="originate {fax_verbose=true}$DEST &txfax($TMPFAX)" >> $TMPLOG
＃这将将日志与已翻译的传真副本一起发送给发件人
＃更改扩展名.tiff为.tif适用于fusionpbx，如果不使用可以删除
FAXBASE=$(basename "$TMPFAX")
NEWFAX=${FAXBASE/tiff/tif}
＃这将通过电子邮件发送带有状态结果的邮件
＃如果没有安装mpack，则使用该方法
＃sendmail -v $2 -f fax@mydomain.com -r fax@mydomain.com <$TMPLOG
＃这将通过电子邮件发送传真作为附件，需要安装mpack
mpack -s "成功传真给 $1" -d $TMPLOG $TMPFAX $2
＃将传真文件放入发出文件夹 - 将“1010”更改为您的传真分机号码
＃这是fusionpbx的默认位置，YMMV
cp $TMPFAX "/usr/local/freeswitch/storage/fax/1010/sent/$NEWFAX"
＃删除传真
rm $TMPFAX
```

### 配置应用程序

可以使用 `spandsp.conf.xml` 全局控制该应用程序：

```xml
<configuration name="spandsp.conf" description="FAX application configuration">
 <fax-settings>
 <param name="use-ecm" value="true"/>
 <param name="verbose" value="true"/>
 <param name="disable-v17" value="false"/>
 <param name="ident" value="SpanDSP Fax Ident"/>
 <param name="header" value="SpanDSP Fax Header"/>
 <param name="spool-dir" value="/tmp"/>
 <param name="file-prefix" value="faxrx"/>
 </fax-settings>
</configuration>
```

### 控制应用程序

您可以设置以下通道变量来控制mod应用程序的行为：

| 变量                          | 描述                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
| ---------------------------- | ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| t38\_gateway\_detect\_timeout |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| FAX\_DISABLE\_ECM            | 禁用ECM（错误校正模式）                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| fax\_disable\_v17            | 禁用V17调制解调器,即使用较低速度调制解调器（较低速度是与远程方自动协商的，无法强制。这是spandsp调制解调器自己处理的工作。）                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
| fax\_enable\_t38             | 按呼叫启用T.38                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| fax\_enable\_t38\_insist     |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| fax\_enable\_t38\_request    | 在通过音调检测检测到传真时发送T.38-ReINVITE                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
| fax\_end\_page               | 指定传送或接收文档的结束页                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
| fax\_force\_caller           | 强制作为呼叫方或接收方操作; 模式：Tx=1或Rx=0                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
| fax\_ident                   | FAX标识应设置为FAX交换中要使用的电话号码。这通常会出现在远程端的液晶显示屏上。理论上，它应该限制为数字、空格、+和其他符合电话号码要求的一个或两个字符。实际上，传真机通常可以接受任何文本，最长为20个字符。这个字符串也可能在页头中起作用。要完全禁用此标题的显示，请将其设置为"\_undef\_"（注意下划线）。                                                                                                                                         |
| fax\_header                  | 如果将fax\_header设置为非空字符串，则会在每个页面的开头插入一个标题行，就像一个典型的传真机那样。fax\_ident、fax\_header和页码将用于形成此行的文本。如果您正在转发传真，则可能不希望添加标题行，因为原始源已经插入了一个标题行。如果您正在发送一个本地生成的传真，则可能确实希望为每个页面添加标题行。要完全禁用此标题的显示，请将其设置为"\_undef\_"（注意下划线）。                                                                                                                        |
| fax\_prefix                  | 为接收到的传真文件名添加前缀。                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 |
| fax\_start\_page             | 指定发送的文档将从指定页开始                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    |
| fax\_use\_ecm                | 在全局禁用的情况下，按呼叫启用ECM（错误校正模式）                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
| ~~fax\_v17\_disabled~~       | ~~与fax\_disable\_v17相同吗？看起来是T.30传真模式~~                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
| fax\_verbose                 | 打印日志时显示详细信息（按呼叫启用）                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
| t38\_peer                    |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
| t38\_trace                   |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |

### 检查结果

当Rx/Tx传真终止时，将设置以下通道变量：

**通过mod\_spandsp.c**

```xml
t38_leg
```

**通过mod\_spandsp\_fax.c**

```xml
fax_bad_rows
fax_document_total_pages
fax_document_transferred_pages
fax_ecm_requested - 0/1
fax_ecm_used - "on" 或 "off";
fax_filename - 收到的传真文件名
fax_image_resolution - XxY
fax_image_size
fax_local_station_id
fax_result_code - 如果发生错误则为0，否则大于等于1;
fax_result_text - 传真错误字符串，提供出现错误的信息;
fax_remote_station_id
fax_success - 如果发生错误则为0，成功则为1;
fax_transfer_rate - 以波特率（比特每秒）表示的速度，如14.400、9.600等;
fax_v17_disabled - 是否为T.30模式的0/1?
jitterbuffer_msec - 总是为0
rtp_autoflush_during_bridge
t38_gateway_format - "audio" 或 "udptl"
t38_peer - "self" 或 "peer"
t38_trace_read
```

#### 传真结果代码

[传真结果代码](../Introduction/Variables/index.mdx#2-show-variables)详见变量页面。

### t38_gateway 应用

t38\_gateway 拨号计划应用允许FreeSWITCH进行音频&lt;->t.38的转码。如果听到音调，它将转为T38网关。

```xml
<extension name="audio_aleg_t38_bleg">
  <condition>
    <action application="set" data="fax_enable_t38=true"/>
    <action application="set" data="execute_on_answer=t38_gateway peer"/>
    <action application="bridge" data="sofia/external/1234@host"/>
  </condition>
</extension>
```

#### T.38 重新邀请

您还可以使用t38\_gateway应用让FreeSWITCH监听并发送重新邀请给a-leg或将其转发到b-leg。例如，这将将A-leg上的传入T.38转码为b-leg上的ULAW。（例如，将传入的T.38传真发送到Asterisk上的Hylafax）

**T.38 重新邀请**

```xml
<extension name="t38_transcode">
  <condition field="destination_number" expression="^(fax_transcode)$">	
    <action application="set" data="fax_enable_t38=true"/>
    <action application="set" data="fax_enable_t38_request=true"/> <!-- Enable t38_gateway to send a t.38 reinvite when a fax tone is detected. -->
    <action application="set" data="execute_on_answer=t38_gateway peer"/> <!--Execute t38_gateway on answer. peer: send a reinvite forward to the b-leg. -->
    <action application="bridge" data="sofia/external/1234@host"/>
  </condition>
</extension>
```

如果你想在A-leg上将T.38转码为B-leg上的T.30音频，并且你想要在A-leg上响应一个传入的T.38邀请/重新邀请，而不是检测CNG音调。

注意:您可能需要在hylafax上增加FaxT2Timer以增加可靠性。

**T.38转码**

```xml
<extension name="t38_transcode">
  <condition field="destination_number" expression="^(fax_transcode)$">	
    <action application="set" data="fax_enable_t38=true"/>
    <action application="set" data="sip_execute_on_image=t38_gateway peer nocng"/> <!--在A-leg上执行t38_gateway，当A-leg上有t.38邀请时，"nocng"意味着不检测CNG音调，直接开始转码到b-leg -->
    <action application="bridge" data="sofia/external/1234@host"/>
  </condition>
</extension>
```

如果你想在A-leg上将音频转码为B-leg上的T.38，从B-leg上的T.38邀请： 

**T.38转码**

```xml
<extension name="t38_transcode">
  <condition field="destination_number" expression="^(fax_transcode)$">
    <action application="set" data="fax_enable_t38=true"/>
    <action application="bridge" data="{sip_execute_on_image='t38_gateway self nocng'}sofia/internal/ext@host"/> <!-- "nocng"意味着不检测CNG音调。只需开始转码 -->
  </condition>
</extension>
```

如果希望在A端对t.38进行转码至B端的音频，当A端邀请t.38时，并且拒绝B端的所有t.38邀请:

**T.38转码**

```xml
<extension name="t38_test" continue="true">
  <condition field="destination_number" expression="^(fax_transcode)$"> 
    <action application="set" data="sip_execute_on_image=t38_gateway self nocng"/>
    <action application="bridge" data="{refuse_t38=true},sofia/gateway/external/$1" />
  </condition>
</extension>
```

允许A端和B端之间的t.38，但仅当t.38的重邀请来自A端时才允许：

```xml
<extension name="passthrough">
  <condition field="destination_number" expression="^(fax_transcode)$">
    <!-- 允许来自Leg A的T.38重邀请 -->
    <action application="set" data="t38_passthru=true"/>
    <!-- 但是拒绝来自Leg B的重邀请 -->
    <action application="bridge" data="{refuse_t38=true},sofia/gateway/external/$1"/>
  </condition>
</extension>
```

### 接收传真

传真接收应用程序

rxfax [文件名]

如果文件名为空，则默认创建以下形式的名称：

spool/prefix-number-timestamp.tif

其中：

* spool由“spool-dir”配置设置
* prefix由“fax_prefix”通道变量或“file-prefix”配置设置
* number是接收传真数量的计数
* timestamp是当前时间的微秒数

示例用法：

```xml
&lt;action application="set" data="fax_prefix=${uuid}"/>
&lt;action application="rxfax" data=""/>

### 传真发送

传真发送应用程序。建议将 `ignore_early_media` 设置为 true，以避免一些数据包重排序问题。

txfax &lt;文件名>

用法示例：

&lt;action application="txfax" data="/tmp/YouAreFired.tif"/>

### 传真音调检测

&lt;action application="spandsp_start_fax_detect" data="&lt;应用程序> '[&lt;应用程序参数>]' [&lt;超时>] [&lt;音调类型>]"/>

使用 spandsp 代码来检测传真音调，相比使用 `tone_detect` 更可靠。默认情况下，该应用程序检测 CNG 音调（发送方）。

`音调类型` 可设置为 "ced" 以检测 CED 音调（接收方）。

用法示例：

&lt;action application="spandsp_start_fax_detect" data="transfer 'fax XML default' 3"/>

该应用程序被调用后将监听 3 秒钟，如果检测到传真音调，将会将呼叫转接到 "default" 上下文的 "XML" 拨号计划中的 "fax" 分机。注意使用单引号将 spandsp\_start\_fax\_detect 目标拨号计划应用的参数括起来。

用法示例：

&lt;action application="set" data="execute_on_answer=spandsp_start_fax_detect transfer 'fax XML default' 3"/>

该应用程序被接听后（由用户或其他应用程序如语音邮件接听），将监听 3 秒钟，如果检测到音调，则将呼叫转接到 "default" 上下文的 "XML" 拨号计划中的 "fax" 分机。这种设置最接近 "传真机与常规电话在同一模拟线上" 的情况。

#### 完整示例
```

我们需要应答电话，让FreeSWITCH接收音频以开始检测传真音调。因为应答后的桥接实际上是转接，所以现在称为转接的振铃由`transfer_ringback`定义。

```xml
<extension name="group_dial_sales">
  <condition field="destination_number" expression="^sales$">
    <action application="answer"/>
    <action application="set" data="transfer_ringback=${us-ring}"/>
    <action application="spandsp_start_fax_detect" data="transfer 'FAX XML default' 6"/>
    <action application="bridge" data="${group_call(sales@${domain_name})}"/>
  </condition>
</extension>
```

### 停止传真音调检测

&lt;action application="spandsp_stop_fax_detect"/>

## 示例

这是一个使用FreeSWITCH作为T.38网关的工作示例。

我使用了以下软件和设备：

* FAX\_B: Infotec IF2100e
* ATA\_B: Cisco 186 v3.2.1
* FAX\_A: RICOH FAX2000L (Super G3, 14.400 Baud)
* ATA\_A: Grandstream HandyTone 502  
   * 产品型号: HT-502 V1.2A  
   * 固件版本: Program-- 1.0.3.10 Bootloader-- 1.0.0.9 Core-- 1.0.3.6 Base-- 1.0.3.8
* FreeSWITCH: 2010-11-19的git head版本
* PRI E1-Stack: openzap
* Sangoma-Wanpipe: 版本3.5.17
* TDM-Card: Sangoma A104d

Grandstream

**FXS端口1**

* 传真模式: T.38 (自动检测)
* 传真音调检测模式: "被叫或主叫"
* 首选编解码器: PCMA
* 禁用回声抵消器 (LEC): 是
* 抖动缓冲区: 高
* 增益: 发送=0dB, 接收=0dB

**spandsp.conf.xml**

```xml
<configuration name="spandsp.conf" description="Fax example">
  <fax-settings>
    <param name="use-ecm" value="true"/>
    <param name="verbose" value="true"/>
    <param name="disable-v17" value="false"/>
    <param name="enable-t38" value="false"/>
    <param name="enable-t38-request" value="false"/>
    <param name="ident" value="SpanDSP传真标识"/>
    <param name="header" value="SpanDSP传真头"/>
    <param name="spool-dir" value="/tmp"/>
    <param name="file-prefix" value="faxrx"/>
  </fax-settings>
</configuration>
```

### Outbound Fax T.38 to TDM

这个排列的顺序如下：

Fax\_A- > ATA\_B -> SIP -> t38\_gateway -> FreeSWITCH -> mod\_openzap -> ISDN/PRI E1 -> Fax

我在这里使用了一个XML拨号计划。与上面的文档相反，我必须先应答电话，然后在拨号计划中开始呼叫t38\_gateway应用，而不是将其放在"execute\_on\_answer"中，对我而言这无法正常工作。 - [Helmut Kuper](https://freeswitch.org/confluence/display/~hekuper)

```xml
<extension name="Fax_test2">
  <condition field="caller_id_number" expression="^(4919)$"/>
  <condition field="destination_number" expression="^(.*)$"/>
    <action application="set" data="absolute_codec_string=PCMA"/>
    <action application="set" data="fax_enable_t38=true"/>
    <action application="set" data="fax_enable_t38_request=true"/>
    <action application="answer"/>
    <action application="t38_gateway" data="self"/>
    <action application="bridge" data="openzap/1/a/$1"/>
    <action application="hangup"/>
  </condition>
</extension>
```

### Inbound Fax TDM to T.38

我在这里使用了Lua拨号计划。与上述文档相反，"同伴"模式无法正常工作。- [Helmut Kuper](https://freeswitch.org/confluence/display/~hekuper)

传真_B -> ISDN/PRI E1 -> mod_openzap -> FreeSWITCH -> T38_gateway -> SIP -> ATA_A -> 传真_A（4919）

**Lua传入传真拨号计划**

```py
if (dialed_ext == "4919") then
 session:setAutoHangup(false)
 session:execute("export", "nolocal:fax_enable_t38=true")
 session:execute("export", "nolocal:fax_enable_t38_request=true")
 session:execute("export", "nolocal:execute_on_answer=t38_gateway self")
 session:execute("export", "nolocal:absolute_codec_string=PCMA")
 session:execute("bridge", "user/".."4919@"..sip_domain)
 return
end
```

"dialed_ext"包含ATA或传真的目标号码。
"sip_domain"包含FreeSWITCH SIP域名。

### 内部 T.38 to T.38

我在这里使用了T.38直通模式。因此，FS只需充当RTP和UDPTL数据的代理。

传真_A（4919）-> ATA_A -> SIP -> FreeSWITCH -> SIP -> ATA（与ATA_A相同） -> 传真_B（2799）

**内部 T.38 to T.38**

```xml
<extension name="Fax_test t.38 to t.38 via t38-passthru">
  <condition field="caller_id_number" expression="^(4919)$" break="on-true"/>
  <condition field="destination_number" expression="^(2799)$">
    <action application="set" data="absolute_codec_string=PCMA"/>
    <action application="set" data="proxy_media=true"/>
    <action application="set" data="bypass_media=false"/>
    <action application="bridge" data="user/2799@<domain>"/>
    <action application="hangup"/>
  </condition>
</extension>
```

## 结果

由[Stavros Patiniotis](https://freeswitch.org/confluence/display/~stavros)提供

我成功地通过传真发送了8页纸。完整的传输路径如下：

```xml
Fax_A <-> ATA_A <-> SIP/UDP <-> t38_gateway <-> FreeSWITCH <-> mod_openzap <----> ISDN/PRI E1 --|
                                               ----------------------------                     |
                                              /                            \               Ayaya-PBX
                                             /                              \                   |
Fax_B <-> ATA_B <-> SIP/UDP/G711a     <-----/                                \<-> ISDN/PRI E1 --|
```

### 测试时遇到的问题

\* "peer"模式和"self"模式之间有什么区别，为什么"peer"模式不起作用？

\* 为什么在T.38->TDM方向的呼叫中，通过execute\_on\_answer调用"t38\_gateway self"不起作用？t38\_gateway被调用，它设置了一个媒体BUG，但是似乎一直在等待一个音调，并在20秒的超时后中断。

## 事件

### spandsp::rxfaxpageresult

### spandsp::txfaxpageresult

### spandsp::rxfaxnegociateresult

### spandsp::txfaxnegociateresult

### spandsp::txfaxresult

完成传真发送后触发此事件（无论成功还是失败）。一个标题指示传真是否成功。

除了会话的常规标题外，它还包括：

fax-document-transferred-pages  
fax-document-total-pages  
fax-image-resolution  
fax-image-size  
fax-bad-rows  
fax-transfer-rate  
fax-result-code  
fax-result-text  
fax-ecm-used  
fax-local-station-id  
fax-remote-station-id

这些在上面没有列出。

### spandsp::rxfaxresult

完成传真接收后触发此事件（无论成功还是失败）。一个标题指示传真是否成功。

除了会话的标题外，它还包括：

## 传真文档传输页数
`[to_be_replace[0]]`
## 传真文档总页数
`> 原文地址: <https://wiki-power.com/>`
## 传真图像分辨率
`> 本篇文章受 [CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by/4.0/deed.zh) 协议保护，转载请注明出处。`
## 传真图像大小
`](https://wiki-power.com/ar/`
## 传真错误行数
`[to_be_replace[4]]`
## 传真传输速率
`[to_be_replace[5]]`
## 传真结果代码
`[to_be_replace[6]]`
## 传真结果文本
`[to_be_replace[7]]`
## 使用的传真ECM
`[to_be_replace[8]]`
## 本地传真站点ID
`[to_be_replace[9]]`
## 远程传真站点ID
`[to_be_replace[10]]`

以上是未记录的。

## 故障排除

在VOIP上传真可能非常麻烦，尽管FreeSWITCH做出了巨大的努力，但要匹配公共交换电话网的可靠性（对于传输模拟编码数据而言）仍然很难。使用下面概述的方法并配以一个支持T.38协议的良好供应商，我可以达到90-95%的成功率，多次尝试可能会稍微提高。如果远程传真机支持T.38协议，则其正常工作的机会较大。

### 常见问题

* 远程机器不正常（或根本不支持）T.38，这将使问题变得更糟，而且在PSTN机器中很常见。
* 在每次转码之间加入T.38网关（或多个网关）会降低成功的机会。
* 运营商/供应商对T.38支持不好，或者标准编解码器的质量较差。一些运营商最终会使用其他几家运营商，通话经过的运营商越多或者路由质量越低，传真的困难就会增加。选择质量好的运营商非常重要！
* 一些远程传真机和PSTN线路的质量也可能较低，所以尽管总体上可能会取得好的成功率，但某些机器可能始终是一个挑战。
* 确保你的tiff文件大小正确。传真机支持多种尺寸，但1728x1078可能是最常见的尺寸（且为标准分辨率）。大约是204x98dpi; "super fine" 传真使用更高的分辨率。确保正确的分辨率和尺寸是与许多远程传真机无缝工作的重要一步。
* 确保启用ignore_early_media，否则随机/乱序的媒体可能会引发问题。
* 对于编解码器，通常应强制使用PCMU/PCMA（除非你使用其他更好的编解码器有成功经验）；那通常会给你最好的结果。
* 请求T.38有时会因为一些不正确处理或理解T.38的因素导致失败。
* 许多“模拟”PSTN线路现在实际上是通过VoIP传输回中央办公室，因此您甚至不能再依赖这些线路传输数据调制解调器信号。

### 建议的流程

* 首先尝试最佳方法，启用并请求t38，打开ECM。
* 其次，如果失败了，我们关闭t38请求和ECM，然后再次尝试。
* 如果仍然失败，我们保持t38和ECM关闭，并再次尝试，如果仍然失败，未来成功的机会很低。

### 示例

使用命令行启动传真的示例：

originate {ignore_early_media=true,absolute_codec_string='PCMU,PCMA',fax_enable_t38=true,fax_verbose=true,fax_use_ecm=true,fax_enable_t38_request=true}sofia/gateway/default/1231231234 &txfax('test_fax.tif')

如果这仍然失败，可以使用以下配置再次尝试：

originate {ignore_early_media=true,absolute_codec_string='PCMU,PCMA',fax_enable_t38=true,fax_verbose=true,fax_use_ecm=false,fax_enable_t38_request=false}sofia/gateway/default/1231231234 &txfax('test_fax.tif')

### 进一步调试

将fax_verbose设置为true会输出大量有关传真的数据，请仔细查看，因为可能只有一行代码揭示了问题。通常情况下，控制台调试日志也会很有帮助。

## 声音检测

mod_spandsp提供了比FreeSWITCH核心默认提供的更好的音调检测功能。

### DTMF

mod_spandsp中的内部DTMF检测器可以检测音调的持续时间和频率。FreeSWITCH核心中的Teletone检测器基于较旧版本的spandsp，应该使用这个检测器来替代。

#### 相关音调通道变量

这些变量的定义可以在[变量页面](../Dialplan/Variables-Archive/x__Variables_6587314.mdx)上找到。

dtmf_verbose（音调详细模式）

min_dup_digit_spacing_ms（最小重复数字间隔时间）

spandsp_dtmf_rx_threshold（spandsp接收音调的阈值）

spandsp_dtmf_rx_twist（spandsp接收音调的扭曲度）

spandsp_dtmf_rx_reverse_twist（spandsp接收音调的反向扭曲度）

spandsp_dtmf_rx_filter_dialtone（spandsp接收音调时的拨号音过滤）

#### 拨号计划应用程序

spandsp_start_dtmf

开始检测包含DTMF TouchTones的基带音频。请注意，这不是RFC2833 RTP检测，它是通过模拟电话发送的DTMF音调的零交叉计数。

&lt;action application="spandsp_start_dtmf"/>

spandsp\_stop\_dtmf

停止在此会话中检测基带音频中的DTMF。当您确信不会出现DTMF时，停止DTMF检测可以节省一些计算资源。

&lt;action application="spandsp_stop_dtmf"/>

### 通话进程

mod\_spandsp提供了创建通话进程音调检测器的工具。通过考虑时序和频率，这个通话进程检测器可以区分北美的BUSY和REORDER两种音调，它们的区别仅在于时序。

#### 配置

conf/autoload\_configs/spandsp.conf.xml定义了音调检测器描述符。每个描述符定义了要检测的音调的命名组。在启动音调检测器时，您需要指定要检测的音调组。

以下是在北美检测一些通话进程音调的示例配置：

**通话进程音调检测**

```xml
<configuration name="spandsp.conf" description="音调侦测描述">
  <descriptors debug-level="0">
  <!-- 这些音调定义在ITU运营公告781附件-2003年1月2日 -->
  <!-- 根据ITU-T建议E.180使用的各种国家网络音调（1998年3月） -->
  <!-- 北美洲 -->
    <descriptor name="1">
      <tone name="CED_TONE" description="ANS / ANSam">
        <element freq1="2100" freq2="0" min="700" max="0"/>
      </tone>
      <tone name="SIT" description="特殊信息音调">
        <element freq1="950" freq2="0" min="256" max="400"/>
        <element freq1="1400" freq2="0" min="256" max="400"/>
        <element freq1="1800" freq2="0" min="256" max="400"/>
      </tone>
      <tone name="RING_TONE" description="北美洲铃声">
        <element freq1="440" freq2="480" min="1200" max="0"/>
      </tone>
      <tone name="REORDER_TONE" description="北美洲订单">
        <element freq1="480" freq2="620" min="224" max="316"/>
        <element freq1="0" freq2="0" min="168" max="352"/>
        <element freq1="480" freq2="620" min="224" max="316"/>
      </tone>
      <tone name="BUSY_TONE" description="北美洲占线">
        <element freq1="480" freq2="620" min="464" max="536"/>
        <element freq1="0" freq2="0" min="464" max="572"/>
        <element freq1="480" freq2="620" min="464" max="536"/>
      </tone>
    </descriptor>
  </descriptors>
</configuration>
```

每个描述符定义要检测的音调。每个音调由定义音调频率和节奏的元素组成。音调名称将在DETECTED_TONE事件中报告。每个元素可以由0（静音）、1或2个频率组成。min和max定义了元素持续时间的最小和最大值（以毫秒为单位）。

##### 调整检测器

需要经过多次尝试才能找到不会引入举（talk-off）问题、工作良好的音调配置。可以通过更改spandsp.conf.xml文件中描述符标记中的debug-level参数来增加调试级别。将级别设置为2，以报告额外的检测信息，以帮助调整过程。

“音调报告”日志会告诉您何时检测到音调。

“音调分段”日志将告诉您检测到的每个分段。f1和f2的值标识该分段中匹配的频率。

#### 拨号计划应用

start_tone_detect

以节奏开始背景音调检测。

&lt;!-- 开始对北美呼叫进展音调进行检测 -->
&lt;action application="start_tone_detect" data="1"/>

stop_tone_detect

停止背景音调检测。

&lt;action application="stop_tone_detect"/>

#### API

start_tone_detect

以节奏开始背景音调检测。

start_tone_detect &lt;uuid> &lt;描述符名称>

stop_tone_detect

停止背景音调检测。

stop_tone_detect &lt;uuid>

#### 事件

DETECTED_TONE

当音调检测器检测到音调时，会触发此事件。

设置以下标头：

Detected-Tone

Unique-ID

Detected-Tone标头将包含配置文件中指定的音调名称。

Unique-ID将包含会话UUID。

## 编解码器

Spandsp实现了以下编解码器：

* ADPCM (IMA)
* G.726
* G.722
* G.711
* GSM
* LPC-10

## 软件调制解调器

SpanDSP 还可以充当软调制解调器。要启用软调制解调器功能，请参阅 [HylaFax](../Auxiliary-Knowledge-and-Utilities/HylaFax_13173342.mdx#esl) 集成页面。设置应该是相同的，但您可以像对待常规的拨号调制解调器一样向其发送命令。

### Windows 的 COM 端口设置

SpanDSP 使用从 COM4 开始的 COM 端口。要将 COM 端口回环到应用程序，可能需要使用外部软件（例如 [com0com](http://com0com.sourceforge.net/)）。

## 另请参阅

<http://www.soft-switch.org/t38/index.html> — 这里有关于 T.38 的更多信息

<http://www.itu.int/pub/T-SP-OB.781-2003> — 国家网络中使用的各种音调

<https://www.soft-switch.org/spandsp%5Ffaq/ar01s14.html> — 如何生成与传真兼容的多页 TIFF

[Fax on AudioCodes Mediant](../Interoperability/Gateways/AudioCodes-Gateways/Fax-on-AudioCodes-Mediant_6586678.mdx#about) 

### 评论：

| \# wget <http://fisheye.freeswitch.org/browse/freeswitch-contrib.git/sathieu/email2pdf>\--2015-11-09 13:11:50-- <http://fisheye.freeswitch.org/browse/freeswitch-contrib.git/sathieu/email2pdf>正在解析 [fisheye.freeswitch.org](http://fisheye.freeswitch.org)... 209.105.235.6, 2607:f348:1021::6连接到 [fisheye.freeswitch.org](http://fisheye.freeswitch.org)\|209.105.235.6|:80... 已连接发送 HTTP 请求，等待响应... 301 Moved Permanently定向到 <https://freeswitch.org/fisheye/browse/freeswitch-contrib.git/sathieu/email2pdf> \[跟随至\]\--2015-11-09 13:11:51-- <https://freeswitch.org/fisheye/browse/freeswitch-contrib.git/sathieu/email2pdf>正在解析 [freeswitch.org](http://freeswitch.org)... 209.105.235.6, 2607:f348:1021::6连接到 [freeswitch.org](http://freeswitch.org)|209.105.235.6|:443... 已连接发送 HTTP 请求，等待响应... 404 找不到该存储库：freeswitch-contrib.git2015-11-09 13:11:51 错误 404: 找不到该存储库：freeswitch-contrib.git。 ![](/images/icons/contenttypes/comment_16.png) 由denis发布于Nov 09, 2015 05:12 |
| ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |

# Markdown Elements

这是一个示例Markdown文档，用于演示各种Markdown元素的使用。

## 标题

这是一级标题
====================

这是二级标题
--------------------

### 这是三级标题

#### 这是四级标题

##### 这是五级标题

###### 这是六级标题

## 强调和斜体

这是一个**粗体**的文本。

这是一个*斜体*的文本。

## 列表

### 无序列表

- 列表项1
- 列表项2
- 列表项3

### 有序列表

1. 列表项1
2. 列表项2
3. 列表项3

## 链接

这是一个[链接到谷歌](https://www.google.com)的示例。

## 图片

这是一个图片：

![示例图片](https://example.com/image.jpg)

## 引用

> 这是一个引用的文本示例。

## 代码块

下面是一段代码的示例：

```python
print("Hello, world!")
```

## 表格

| 列1      | 列2  |
| ----------- | ----------- |
| 单元格1      | 单元格2       |
| 单元格3   | 单元格4        |